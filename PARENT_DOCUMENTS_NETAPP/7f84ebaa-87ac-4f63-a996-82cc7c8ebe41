Prepare the hosts (Ubuntu or Debian) How host-wide settings change during installation

On bare metal systems, StorageGRID makes some changes to host-wide sysctl settings.

The following changes are made:

149

# Recommended Cassandra setting: CASSANDRA-3563, CASSANDRA-13008, DataStax documentation vm.max_map_count = 1048575

# core file customization # Note: for cores generated by binaries running inside containers, this # path is interpreted relative to the container filesystem namespace. # External cores will go nowhere, unless /var/local/core also exists on # the host. kernel.core_pattern = /var/local/core/%e.core.%p

# Set the kernel minimum free memory to the greater of the current value or # 512MiB if the host has 48GiB or less of RAM or 1.83GiB if the host has more than 48GiB of RTAM vm.min_free_kbytes = 524288 # Enforce current default swappiness value to ensure the VM system has some # flexibility to garbage collect behind anonymous mappings. Bump watermark_scale_factor # to help avoid OOM conditions in the kernel during memory allocation bursts. Bump # dirty_ratio to 90 because we explicitly fsync data that needs to be persistent, and # so do not require the dirty_ratio safety net. A low dirty_ratio combined with a large # working set (nr_active_pages) can cause us to enter synchronous I/O mode unnecessarily, # with deleterious effects on performance. vm.swappiness = 60 vm.watermark_scale_factor = 200 vm.dirty_ratio = 90 # Turn off slow start after idle net.ipv4.tcp_slow_start_after_idle = 0

# Tune TCP window settings to improve throughput net.core.rmem_max = 8388608 net.core.wmem_max = 8388608 net.ipv4.tcp_rmem = 4096 524288 8388608 net.ipv4.tcp_wmem = 4096 262144 8388608 net.core.netdev_max_backlog = 2500

# Turn on MTU probing net.ipv4.tcp_mtu_probing = 1

150 # Tune TCP window settings to improve throughput net.core.rmem_max = 8388608 net.core.wmem_max = 8388608 net.ipv4.tcp_rmem = 4096 524288 8388608 net.ipv4.tcp_wmem = 4096 262144 8388608 net.core.netdev_max_backlog = 2500

# Turn on MTU probing net.ipv4.tcp_mtu_probing = 1

150

# Be more liberal with firewall connection tracking net.ipv4.netfilter.ip_conntrack_tcp_be_liberal = 1

# Reduce TCP keepalive time to reasonable levels to terminate dead connections net.ipv4.tcp_keepalive_time = 270 net.ipv4.tcp_keepalive_probes = 3 net.ipv4.tcp_keepalive_intvl = 30

# Increase the ARP cache size to tolerate being in a /16 subnet net.ipv4.neigh.default.gc_thresh1 = 8192 net.ipv4.neigh.default.gc_thresh2 = 32768 net.ipv4.neigh.default.gc_thresh3 = 65536 net.ipv6.neigh.default.gc_thresh1 = 8192 net.ipv6.neigh.default.gc_thresh2 = 32768 net.ipv6.neigh.default.gc_thresh3 = 65536 # Disable IP forwarding, we are not a router net.ipv4.ip_forward = 0

# Follow security best practices for ignoring broadcast ping requests net.ipv4.icmp_echo_ignore_broadcasts = 1

# Increase the pending connection and accept backlog to handle larger connection bursts. net.core.somaxconn=4096 net.ipv4.tcp_max_syn_backlog=4096 Install Linux

You must install StorageGRID on all Ubuntu or Debian grid hosts. For a list of supported versions, use the NetApp Interoperability Matrix Tool.

Ensure that your operating system is upgraded to Linux kernel 4.15 or higher.

Steps

1. Install Linux on all physical or virtual grid hosts according to the distributor’s instructions or your standard procedure.

Don’t install any graphical desktop environments. When installing Ubuntu, you must select standard system utilities. Selecting OpenSSH server is recommended to enable ssh access to your Ubuntu hosts. All other options can remain cleared.

2. Ensure that all hosts have access to Ubuntu or Debian package repositories.

3. If swap is enabled:

a. Run the following command: $ sudo swapoff --all

151

b. Remove all swap entries from /etc/fstab to persist the settings.

Failing to disable swap entirely can severely lower performance. Understand AppArmor profile installation

If you are operating in a self-deployed Ubuntu environment and using the AppArmor mandatory access control system, the AppArmor profiles associated with packages you install on the base system might be blocked by the corresponding packages installed with StorageGRID.

By default, AppArmor profiles are installed for packages that you install on the base operating system. When you run these packages from the StorageGRID system container, the AppArmor profiles are blocked. The DHCP, MySQL, NTP, and tcdump base packages conflict with AppArmor, and other base packages might also conflict.

You have two choices for handling AppArmor profiles:

Disable individual profiles for the packages installed on the base system that overlap with the packages in the StorageGRID system container. When you disable individual profiles, an entry appears in the StorageGRID log files indicating that AppArmor is enabled.