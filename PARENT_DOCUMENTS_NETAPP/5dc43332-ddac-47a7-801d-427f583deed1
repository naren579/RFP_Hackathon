4. Click Start Recovery.

5. Monitor the progress of the recovery in the Recovering Grid Node table.

When the grid node reaches the "Waiting for Manual Steps" stage, go to the next topic and perform the manual steps to remount and reformat appliance storage volumes.

At any point during the recovery, you can click Reset to start a new recovery. A dialog box appears, indicating that the node will be left in an indeterminate state if you reset the procedure.

1564

If you want to retry the recovery after resetting the procedure, you must restore the appliance node to a pre-installed state by running sgareinstall on the node. Remount and reformat appliance storage volumes (manual steps)

You must manually run two scripts to remount preserved storage volumes and reformat any failed storage volumes. The first script remounts volumes that are properly formatted as StorageGRID storage volumes. The second script reformats any unmounted volumes, rebuilds the Cassandra database, if needed, and starts services.

Before you begin

You have already replaced the hardware for any failed storage volumes that you know require replacement.

Running the sn-remount-volumes script might help you identify additional failed storage volumes.

You have checked that a Storage Node decommissioning is not in progress, or you have paused the node decommission procedure. (In the Grid Manager, select MAINTENANCE > Tasks > Decommission.)

You have checked that an expansion is not in progress. (In the Grid Manager, select MAINTENANCE > Tasks > Expansion.) Contact technical support if more than one Storage Node is offline or if a Storage Node in this grid has been rebuilt in the last 15 days. Don’t run the sn-recovery-postinstall.sh script. Rebuilding Cassandra on two or more Storage Nodes within 15 days of each other might result in data loss. About this task

To complete this procedure, you perform these high-level tasks:

Log in to the recovered Storage Node.

Run the sn-remount-volumes script to remount properly formatted storage volumes. When this script runs, it does the following:

1565

Mounts and unmounts each storage volume to replay the XFS journal. ◦ Performs an XFS file consistency check. ◦ If the file system is consistent, determines if the storage volume is a properly formatted StorageGRID storage volume.

If the storage volume is properly formatted, remounts the storage volume. Any existing data on the volume remains intact.

Review the script output and resolve any issues. You have checked that a Storage Node decommissioning is not in progress, or you have paused the node decommission procedure. (In the Grid Manager, select MAINTENANCE > Tasks > Decommission.)

You have checked that an expansion is not in progress. (In the Grid Manager, select MAINTENANCE > Tasks > Expansion.) Contact technical support if more than one Storage Node is offline or if a Storage Node in this grid has been rebuilt in the last 15 days. Don’t run the sn-recovery-postinstall.sh script. Rebuilding Cassandra on two or more Storage Nodes within 15 days of each other might result in data loss. About this task

To complete this procedure, you perform these high-level tasks:

Log in to the recovered Storage Node.

Run the sn-remount-volumes script to remount properly formatted storage volumes. When this script runs, it does the following:

1565

Mounts and unmounts each storage volume to replay the XFS journal. ◦ Performs an XFS file consistency check. ◦ If the file system is consistent, determines if the storage volume is a properly formatted StorageGRID storage volume.

If the storage volume is properly formatted, remounts the storage volume. Any existing data on the volume remains intact.

Review the script output and resolve any issues.

Run the sn-recovery-postinstall.sh script. When this script runs, it does the following. Don’t reboot a Storage Node during recovery before running sn-recovery- postinstall.sh (step 4) to reformat the failed storage volumes and restore object metadata. Rebooting the Storage Node before sn-recovery-postinstall.sh completes causes errors for services that attempt to start and causes StorageGRID appliance nodes to exit maintenance mode.

Reformats any storage volumes that the sn-remount-volumes script could not mount or that were found to be improperly formatted.

If a storage volume is reformatted, any data on that volume is lost. You must perform an additional procedure to restore object data from other locations in the grid, assuming that ILM rules were configured to store more than one object copy.

Rebuilds the Cassandra database on the node, if needed. ◦ Starts the services on the Storage Node. Steps

1. Log in to the recovered Storage Node: a. Enter the following command: ssh admin@grid_node_IP

b. Enter the password listed in the Passwords.txt file.

c. Enter the following command to switch to root: su -

d. Enter the password listed in the Passwords.txt file.