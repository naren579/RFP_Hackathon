The object you want to query must be in one of the following formats:

CSV. Can be used as is or compressed into GZIP or BZIP2 archives. ◦ Parquet. Additional requirements for Parquet objects:

▪ S3 Select supports only columnar compression using GZIP or Snappy. S3 Select doesn’t support whole-object compression for Parquet objects.

▪ S3 Select doesn’t support Parquet output. You must specify the output format as CSV or JSON.

932

▪ The maximum uncompressed row group size is 512 MB. ▪ You must use the data types specified in the object’s schema. ▪ You can’t use INTERVAL, JSON, LIST, TIME, or UUID logical types.

Your SQL expression has a maximum length of 256 KB.

Any record in the input or results has a maximum length of 1 MiB. CSV request syntax example You can use the S3 SelectObjectContent request to filter the contents of an S3 object based on a simple SQL statement.

For more information see Amazon Simple Storage Service API Reference: SelectObjectContent.

Before you begin

The tenant account has the S3 Select permission.

You have s3:GetObject permission for the object you want to query.

The object you want to query must be in one of the following formats:

CSV. Can be used as is or compressed into GZIP or BZIP2 archives. ◦ Parquet. Additional requirements for Parquet objects:

▪ S3 Select supports only columnar compression using GZIP or Snappy. S3 Select doesn’t support whole-object compression for Parquet objects.

▪ S3 Select doesn’t support Parquet output. You must specify the output format as CSV or JSON.

932

▪ The maximum uncompressed row group size is 512 MB. ▪ You must use the data types specified in the object’s schema. ▪ You can’t use INTERVAL, JSON, LIST, TIME, or UUID logical types.

Your SQL expression has a maximum length of 256 KB.

Any record in the input or results has a maximum length of 1 MiB. CSV request syntax example

933 POST /{Key+}?select&select-type=2 HTTP/1.1 Host: Bucket.s3.abc-company.com x-amz-expected-bucket-owner: ExpectedBucketOwner <?xml version="1.0" encoding="UTF-8"?> <SelectObjectContentRequest xmlns="http://s3.amazonaws.com/doc/2006-03- 01/"> <Expression>string</Expression> <ExpressionType>string</ExpressionType> <RequestProgress> <Enabled>boolean</Enabled> </RequestProgress> <InputSerialization> <CompressionType>GZIP</CompressionType> <CSV> <AllowQuotedRecordDelimiter>boolean</AllowQuotedRecordDelimiter> <Comments>#</Comments> <FieldDelimiter>\t</FieldDelimiter> <FileHeaderInfo>USE</FileHeaderInfo> <QuoteCharacter>'</QuoteCharacter> <QuoteEscapeCharacter>\\</QuoteEscapeCharacter> <RecordDelimiter>\n</RecordDelimiter> </CSV> </InputSerialization> <OutputSerialization> <CSV> <FieldDelimiter>string</FieldDelimiter> <QuoteCharacter>string</QuoteCharacter> <QuoteEscapeCharacter>string</QuoteEscapeCharacter> <QuoteFields>string</QuoteFields> <RecordDelimiter>string</RecordDelimiter> </CSV> </OutputSerialization> <ScanRange> <End>long</End> <Start>long</Start> </ScanRange> </SelectObjectContentRequest> Parquet request syntax example

934

POST /{Key+}?select&select-type=2 HTTP/1.1 Host: Bucket.s3.abc-company.com x-amz-expected-bucket-owner: ExpectedBucketOwner <?xml version="1.0" encoding="UTF-8"?> <SelectObjectContentRequest xmlns=http://s3.amazonaws.com/doc/2006-03-01/> <Expression>string</Expression> <ExpressionType>string</ExpressionType> <RequestProgress> <Enabled>boolean</Enabled> </RequestProgress> <InputSerialization> <CompressionType>GZIP</CompressionType> <PARQUET> </PARQUET> </InputSerialization> <OutputSerialization> <CSV> <FieldDelimiter>string</FieldDelimiter> <QuoteCharacter>string</QuoteCharacter> <QuoteEscapeCharacter>string</QuoteEscapeCharacter> <QuoteFields>string</QuoteFields> <RecordDelimiter>string</RecordDelimiter> </CSV> </OutputSerialization> <ScanRange> <End>long</End> <Start>long</Start> </ScanRange> </SelectObjectContentRequest> SQL query example

This query gets the state name, 2010 populations, estimated 2015 populations, and the percentage of change from US census data. Records in the file that aren’t states are ignored. This query gets the state name, 2010 populations, estimated 2015 populations, and the percentage of change from US census data. Records in the file that aren’t states are ignored.

SELECT STNAME, CENSUS2010POP, POPESTIMATE2015, CAST((POPESTIMATE2015 - CENSUS2010POP) AS DECIMAL) / CENSUS2010POP * 100.0 FROM S3Object WHERE NAME = STNAME

The first few lines of the file to be queried, SUB-EST2020_ALL.csv, look like this: