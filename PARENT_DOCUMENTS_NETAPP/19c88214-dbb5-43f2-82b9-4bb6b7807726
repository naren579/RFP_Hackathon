The table describes the elements in the metadata notification configuration XML. Name

Description

Required

MetadataNotificationConfi guration

Container tag for rules used to specify the objects and destination for metadata notifications.

Yes

Contains one or more Rule elements.

Rule

Container tag for a rule that identifies the objects whose metadata should be added to a specified index. Yes

Rules with overlapping prefixes are rejected.

Included in the MetadataNotificationConfiguration element.

ID

Unique identifier for the rule.

No

Included in the Rule element.

Status

Status can be 'Enabled' or 'Disabled'. No action is taken for rules that are disabled.

Yes

Included in the Rule element.

957

Name

Description

Required Prefix

Objects that match the prefix are affected by the rule, and their metadata is sent to the specified destination.

Yes

To match all objects, specify an empty prefix.

Included in the Rule element.

Destination

Container tag for the destination of a rule.

Yes

Included in the Rule element.

Urn

URN of the destination where object metadata is sent. Must be the URN of a StorageGRID endpoint with the following properties: Yes

es must be the third element.

The URN must end with the index and type where the metadata is stored, in the form domain- name/myindex/mytype.

Endpoints are configured using the Tenant Manager or Tenant Management API. They take the following form:

arn:aws:es:region:account-

ID:domain/mydomain/myindex/mytype

urn:mysite:es:::mydomain/myindex/myty pe

The endpoint must be configured before the configuration XML is submitted, or configuration will fail with a 404 error.

Urn is included in the Destination element. Request examples

This example shows enabling search integration for a bucket. In this example, object metadata for all objects is sent to the same destination.

958

PUT /test1?x-ntap-sg-metadata-notification HTTP/1.1 Date: date Authorization: authorization string Host: host

<MetadataNotificationConfiguration> <Rule> <ID>Rule-1</ID> <Status>Enabled</Status> <Prefix></Prefix> <Destination> <Urn>urn:sgws:es:::sgws-notifications/test1/all</Urn> </Destination> </Rule> </MetadataNotificationConfiguration> es must be the third element.

The URN must end with the index and type where the metadata is stored, in the form domain- name/myindex/mytype.

Endpoints are configured using the Tenant Manager or Tenant Management API. They take the following form:

arn:aws:es:region:account-

ID:domain/mydomain/myindex/mytype

urn:mysite:es:::mydomain/myindex/myty pe

The endpoint must be configured before the configuration XML is submitted, or configuration will fail with a 404 error.

Urn is included in the Destination element. Request examples

This example shows enabling search integration for a bucket. In this example, object metadata for all objects is sent to the same destination.

958

PUT /test1?x-ntap-sg-metadata-notification HTTP/1.1 Date: date Authorization: authorization string Host: host

<MetadataNotificationConfiguration> <Rule> <ID>Rule-1</ID> <Status>Enabled</Status> <Prefix></Prefix> <Destination> <Urn>urn:sgws:es:::sgws-notifications/test1/all</Urn> </Destination> </Rule> </MetadataNotificationConfiguration>

In this example, object metadata for objects that match the prefix /images is sent to one destination, while object metadata for objects that match the prefix /videos is sent to a second destination.

PUT /graphics?x-ntap-sg-metadata-notification HTTP/1.1 Date: date Authorization: authorization string Host: host <MetadataNotificationConfiguration> <Rule> <ID>Images-rule</ID> <Status>Enabled</Status> <Prefix>/images</Prefix> <Destination> <Urn>arn:aws:es:us-east-1:3333333:domain/es- domain/graphics/imagetype</Urn> </Destination> </Rule> <Rule> <ID>Videos-rule</ID> <Status>Enabled</Status> <Prefix>/videos</Prefix> <Destination> <Urn>arn:aws:es:us-west-1:22222222:domain/es- domain/graphics/videotype</Urn> </Destination> </Rule> </MetadataNotificationConfiguration>

959

JSON generated by the search integration service

When you enable the search integration service for a bucket, a JSON document is generated and sent to the destination endpoint each time object metadata or tags are added, updated, or deleted.

This example shows an example of the JSON that could be generated when an object with the key SGWS/Tagging.txt is created in a bucket named test. The test bucket is not versioned, so the versionId tag is empty. { "bucket": "test", "key": "SGWS/Tagging.txt", "versionId": "", "accountId": "86928401983529626822", "size": 38, "md5": "3d6c7634a85436eee06d43415012855", "region":"us-east-1", "metadata": { "age": "25" }, "tags": { "color": "yellow" } }

Object metadata included in metadata notifications

The table lists all the fields that are included in the JSON document that is sent to the destination endpoint when search integration is enabled.